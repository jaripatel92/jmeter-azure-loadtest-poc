name: Azure Load Test - Manual Token Success

on: [push]

jobs:
  load-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # This step bypasses the 'az login' error by manually setting the token
      - name: 'Azure Load Testing'
        uses: azure/load-testing@v1.1.25
        with:
          loadtestResource: 'cdot-jmeter-test'
          resourceGroup: 'CIPSandbox-rg'
          # We pass the token directly into the action's environment
        env:
          AZURE_ACCESSTOKEN: ${{ secrets.AZ_TOKEN }}
        with:
          # Fixed casing for all inputs
          loadtestConfigFile: 'jmeter/basic_smoke_test.jmx'
          loadtestRunName: 'GitHub-Run-${{ github.run_number }}'
