name: Azure Load Test - Official Fix

on: [push]

jobs:
  load-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # Use the specialized Azure Load Test action
      - name: 'Azure Load Testing'
        uses: azure/load-testing@v1.1.25
        with:
          # This is your unique resource ID from your screenshots
          loadTestResource: 'cdot-jmeter-test'
          loadTestResourceGroup: 'CIPSandbox-rg'
          # Use your refreshed token here
          loadTestAccessToken: ${{ secrets.AZ_TOKEN }}
          # Direct path to your script
          loadTestConfigProp: |
            testId: smoke-test-poc
            testPlan: jmeter/basic_smoke_test.jmx
            engineInstances: 1
